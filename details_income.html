<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Детализация доходов</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* (Сокращенные стили) */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
        }

        :root {
            --alfa-red: #EE3124;
            --alfa-green: #38A34A;
            --text-color: #333;
            --card-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .app-screen {
            width: 100%;
            max-width: 390px;
            background-color: white;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            position: relative;
            padding-bottom: 80px;
        }
        /* (Стили заголовка и навигации такие же, как в expenses.html) */

        .summary-card {
            background-color: var(--alfa-green);
            color: white;
            padding: 25px 20px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .member-card {
            background-color: white;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #eee;
        }

        .member-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .member-header h3 {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
        }
        .member-header h3 i {
            color: var(--alfa-green); /* Green for income */
            margin-right: 10px;
            font-size: 20px;
        }
        .member-amount {
            font-size: 18px;
            font-weight: 700;
            color: var(--alfa-green);
        }
        .category-item i {
            font-size: 8px;
            margin-right: 8px;
            color: var(--alfa-green); /* Green dots for income categories */
        }
    </style>
</head>
<body>

<div class="app-screen">
    
    <div class="top-bar">
        <span>9:41</span>
        <div class="status-icons">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-three-quarters"></i>
        </div>
    </div>

    <header class="header-nav" style="padding: 0 20px; background-color: white; padding-bottom: 20px;">
        <div class="back-title">
            <i class="fas fa-chevron-left back-arrow" id="navToAnalyticsHome"></i>
            <h1 class="header-title">Октябрь</h1>
        </div>
        <h2 class="header-subtitle">Детализация доходов</h2>
        <p class="header-description">
            Подробная разбивка поступлений по каждому члену семьи.
        </p>

        <div class="tabs" style="display: flex; gap: 8px; margin-top: 15px; overflow-x: auto; padding-bottom: 10px;">
            <button class="tab active" style="padding: 6px 12px; border: none; border-radius: 18px; background-color: #000; color: white;">Все</button>
            <button class="tab" style="padding: 6px 12px; border: none; border-radius: 18px; background-color: #f0f0f0; color: #333;">Зарплата</button>
            <button class="tab" style="padding: 6px 12px; border: none; border-radius: 18px; background-color: #f0f0f0; color: #333;">Кэшбэк</button>
        </div>
    </header>

    <main class="content" id="memberCardsContainer" style="padding: 20px; padding-top: 0;">

        <div class="summary-card">
            <p>Общий доход семьи за Октябрь:</p>
            <h2>150 000 ₽</h2>
        </div>
        
        </main>

    <nav class="bottom-nav" style="position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); max-width: 390px; width: 100%; height: 70px; background-color: white; box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05); display: flex; justify-content: space-around; align-items: center; padding-bottom: 5px; font-size: 11px; color: #888; z-index: 20;">
        <div class="nav-item" style="display: flex; flex-direction: column; align-items: center; cursor: pointer; font-weight: 500;">
            <i class="fas fa-home" style="font-size: 22px; margin-bottom: 4px;"></i>
            <span>Главный</span>
        </div>
        <div class="nav-item" style="display: flex; flex-direction: column; align-items: center; cursor: pointer; font-weight: 500;">
            <i class="fas fa-credit-card" style="font-size: 22px; margin-bottom: 4px;"></i>
            <span>Платежи</span>
        </div>
        <div class="nav-item" style="display: flex; flex-direction: column; align-items: center; cursor: pointer; font-weight: 500;">
            <i class="fas fa-heart" style="font-size: 22px; margin-bottom: 4px;"></i>
            <span>Выгода</span>
        </div>
        <div class="nav-item" style="display: flex; flex-direction: column; align-items: center; cursor: pointer; font-weight: 500; color: var(--alfa-red);">
            <i class="fas fa-history" style="font-size: 22px; margin-bottom: 4px;"></i>
            <span>История</span>
        </div>
        <div class="nav-item" style="display: flex; flex-direction: column; align-items: center; cursor: pointer; font-weight: 500;">
            <i class="fas fa-comment-dots" style="font-size: 22px; margin-bottom: 4px;"></i>
            <span>Чаты</span>
        </div>
    </nav>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const memberCardsContainer = document.getElementById('memberCardsContainer');

        // --- LOCAL STORAGE MANAGEMENT ---
        const DEFAULT_MEMBERS_CONFIG = [
            { id: 'father', name: 'Папа', icon: 'male', role: 'Основной пользователь', type: 'main', editable: true, removable: false },
            { id: 'mother', name: 'Мама', icon: 'female', role: 'Пользователь', type: 'user', editable: true, removable: false },
            { id: 'child', name: 'Ребенок', icon: 'child', role: 'Зависимый профиль', type: 'dependent', editable: true, removable: true }
        ];

        function getFamilyMembers() {
            const membersJson = localStorage.getItem('family_members');
            if (membersJson) {
                return JSON.parse(membersJson);
            }
            localStorage.setItem('family_members', JSON.stringify(DEFAULT_MEMBERS_CONFIG));
            return DEFAULT_MEMBERS_CONFIG;
        }

        // --- ШАБЛОНЫ КАРТОЧЕК ДОХОДОВ (Условные данные) ---
        const INCOME_TEMPLATES = {
            'child': {
                amount: '5 000 ₽',
                categories: [
                    { name: 'Подарок', amount: '3 000 ₽' },
                    { name: 'Стипендия', amount: '2 000 ₽' }
                ]
            },
            'mother': {
                amount: '55 000 ₽',
                categories: [
                    { name: 'Зарплата', amount: '44 000 ₽' },
                    { name: 'Кэшбэк', amount: '5 500 ₽' },
                    { name: 'Прочее', amount: '5 500 ₽' }
                ]
            },
            'father': {
                amount: '90 000 ₽',
                categories: [
                    { name: 'Зарплата', amount: '80 000 ₽' },
                    { name: 'Проценты по вкладу', amount: '10 000 ₽' }
                ]
            },
            'dynamic': {
                amount: '0 ₽',
                categories: [
                    { name: 'Дополнительный доход', amount: '0 ₽' }
                ]
            }
        };

        // --- ДИНАМИЧЕСКИЙ РЕНДЕРИНГ ---
        function generateCategoryListHTML(categories) {
            return categories.map(cat => `
                <li class="category-item">
                    <span><i class="fas fa-circle"></i> ${cat.name}</span>
                    <span>${cat.amount}</span>
                </li>
            `).join('');
        }

        function renderMemberCards() {
            const members = getFamilyMembers();
            
            // Удаляем все старые карточки
            const existingCards = document.querySelectorAll('.member-card');
            existingCards.forEach(card => card.remove());
            
            const summaryCard = document.querySelector('.summary-card');
            let html = '';

            members.forEach(member => {
                const templateKey = member.type === 'dynamic' ? 'dynamic' : member.id;
                const template = INCOME_TEMPLATES[templateKey] || INCOME_TEMPLATES['dynamic'];
                
                const iconClass = member.icon ? `fa-${member.icon}` : 'fa-user';

                html += `
                    <div class="member-card" id="member_${member.id}">
                        <div class="member-header">
                            <h3><i class="fas ${iconClass}"></i> <span>${member.name}</span></h3>
                            <span class="member-amount">${template.amount}</span>
                        </div>
                        <ul class="category-list">
                            ${generateCategoryListHTML(template.categories)}
                        </ul>
                    </div>
                `;
            });
            
            if (summaryCard) {
                summaryCard.insertAdjacentHTML('afterend', html);
            } else {
                memberCardsContainer.innerHTML += html;
            }
        }
        
        // --- ИНИЦИАЛИЗАЦИЯ И НАВИГАЦИЯ ---
        renderMemberCards();

        document.getElementById('navToAnalyticsHome').addEventListener('click', () => {
            window.location.href = 'analytics_home.html'; 
        });
    });
</script>
</body>
</html>
