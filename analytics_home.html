<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вся аналитика</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* (Сокращенные стили) */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
        }

        :root {
            --alfa-red: #EE3124;
            --text-color: #333;
            --card-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            /* Цвета для диаграммы */
            --chart-color-1: #95201A;
            --chart-color-2: #D12D22;
            --chart-color-3: #EE3124;
            --chart-color-4: #F56B61;
            --chart-color-5: #F9A8A3;
        }

        .app-screen {
            width: 100%;
            max-width: 390px;
            background-color: white;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            position: relative;
            padding-bottom: 80px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            padding: 8px 25px 8px 20px;
            font-size: 13px;
            font-weight: 600;
        }
        .settings-icon {
            font-size: 20px;
            cursor: pointer;
            color: var(--text-color);
        }
        .header-nav {
            padding: 0 20px;
            background-color: white;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0 10px 0;
        }

        .header-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin: 10px 0 20px 0;
        }
        .tab {
            padding: 6px 15px;
            border: none;
            border-radius: 20px;
            background-color: #f0f0f0;
            color: var(--text-color);
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
        }
        .tab.active {
            background-color: #000;
            color: white;
        }

        .card {
            background-color: white;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            margin: 0 20px 15px 20px;
            padding: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .card-title {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            color: var(--text-color);
        }
        .card-subtitle {
            font-size: 14px;
            color: #888;
            margin: 0;
            margin-top: 5px;
        }
        .alfa-logo-mini {
            width: 20px;
            height: 20px;
            background-color: var(--alfa-red);
            color: white;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 700;
            text-align: center;
            line-height: 20px;
            margin-left: 10px;
            display: inline-block;
        }
        
        .chart-graphic {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            /* Заглушка, будет перезаписано JS */
            background: conic-gradient(var(--chart-color-3) 0% 100%);
            margin: 10px 0 20px 0;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        .chart-center-hole {
            width: 100px;
            height: 100px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .chart-legend {
            width: 100%;
            padding: 0;
            list-style: none;
        }
        .legend-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 16px;
            font-weight: 500;
            border-bottom: 1px solid #f7f7f7;
            align-items: center;
        }
        .legend-item:last-child {
            border-bottom: none;
        }
        .legend-name {
            display: flex;
            align-items: center;
            font-weight: 600;
        }
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .legend-amount {
            font-weight: 700;
            color: var(--alfa-red);
        }
    </style>
</head>
<body>

<div class="app-screen">
    
    <div class="top-bar">
        <span>9:41</span>
        <div class="status-icons">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-three-quarters"></i>
        </div>
    </div>

    <header class="header-nav">
        <div class="header-top">
            <h1 class="header-title">Октябрь</h1>
            <div class="header-icons">
                <div class="nav-arrows">
                    <i class="fas fa-chevron-left"></i>
                    <i class="fas fa-chevron-right"></i>
                </div>
                <i class="fas fa-sliders-h settings-icon" id="navToSettingsFamily"></i>
            </div>
        </div>

        <div class="tabs">
            <button class="tab" id="navToExpenses">Расходы</button>
            <button class="tab" id="navToIncome">Доходы</button>
            <button class="tab active">Вся аналитика</button>
        </div>
    </header>

    <main class="content-area">
        
        <div class="card" id="family-expense-card">
            <div class="card-header">
                <div>
                    <h2 class="card-title">Семейная аналитика расходов</h2>
                    <p class="card-subtitle">Статистика по семейным тратам</p>
                </div>
                <div class="card-icon-arrow" id="navToDetailsExpenses">
                    <span class="alfa-logo-mini">A</span>
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>
            
            <div class="chart-area">
                <div class="chart-graphic" id="expenseChart">
                    <div class="chart-center-hole"></div>
                </div>

                <ul class="chart-legend" id="expenseLegend">
                    </ul>

                <div class="chart-actions">
                    <button class="chart-action-btn" id="editChartLegend">
                        <i class="fas fa-pencil-alt"></i>
                    </button>
                    <button class="chart-action-btn" id="exportChart">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="card" id="ai-recommendation-card" style="margin-top: 15px;">
            <div class="card-header">
                <div>
                    <h2 class="card-title">Рекомендации ИИ</h2>
                    <p class="card-subtitle">На базе семейных расходов</p>
                </div>
                <div class="card-icon-arrow" id="navToAiRecommendations">
                    <span class="alfa-logo-mini">A</span>
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>
            <div class="ai-card-background" style="background: linear-gradient(135deg, #F95349, #F5A800); padding: 20px; border-radius: 15px;">
                <div class="ai-card-text" style="color: white;">
                    <h3>Альфа-ИИ</h3>
                    <p>Задать свой вопрос ИИ &rarr;</p>
                </div>
                <div class="ai-card-button" style="background-color: white; color: #F56B61; padding: 10px 15px; border-radius: 10px; font-size: 16px; font-weight: 700;">
                    Альфа-ИИ 
                    <i class="fas fa-plus"></i>
                </div>
            </div>
        </div>
        
        <div class="card" id="import-data-card">
            <div class="card-header">
                <div>
                    <h2 class="card-title">Импорт данных</h2>
                    <p class="card-subtitle">Для учета расходов из других банков</p>
                </div>
                <div class="card-icon-arrow" id="navToImportData">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>
            <div class="ai-card-background" style="background: linear-gradient(135deg, #007BFF, #00C6FF); padding: 15px; border-radius: 12px; cursor: pointer;">
                <div class="ai-card-text" style="color: white;">
                    <h3 style="font-size: 16px;">Перенести данные о расходах</h3>
                    <p style="font-size: 12px;">Счета других банков, CSV или API</p>
                </div>
                <div class="ai-card-button" style="background-color: white; color: #007BFF; padding: 8px 12px; font-size: 14px;">
                    Начать <i class="fas fa-exchange-alt"></i>
                </div>
            </div>
        </div>
        
    </main>

    <nav class="bottom-nav" style="position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); max-width: 390px; width: 100%; height: 70px; background-color: white; box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05); display: flex; justify-content: space-around; align-items: center; padding-bottom: 5px; font-size: 11px; color: #888; z-index: 20;">
        <div class="nav-item" style="display: flex; flex-direction: column; align-items: center; cursor: pointer; font-weight: 500;">
            <i class="fas fa-home" style="font-size: 22px; margin-bottom: 4px;"></i>
            <span>Главный</span>
        </div>
        <div class="nav-item" style="display: flex; flex-direction: column; align-items: center; cursor: pointer; font-weight: 500;">
            <i class="fas fa-credit-card" style="font-size: 22px; margin-bottom: 4px;"></i>
            <span>Платежи</span>
        </div>
        <div class="nav-item" style="display: flex; flex-direction: column; align-items: center; cursor: pointer; font-weight: 500;">
            <i class="fas fa-heart" style="font-size: 22px; margin-bottom: 4px;"></i>
            <span>Выгода</span>
        </div>
        <div class="nav-item" style="display: flex; flex-direction: column; align-items: center; cursor: pointer; font-weight: 500; color: var(--alfa-red);">
            <i class="fas fa-history" style="font-size: 22px; margin-bottom: 4px;"></i>
            <span>История</span>
        </div>
        <div class="nav-item" style="display: flex; flex-direction: column; align-items: center; cursor: pointer; font-weight: 500;">
            <i class="fas fa-comment-dots" style="font-size: 22px; margin-bottom: 4px;"></i>
            <span>Чаты</span>
        </div>
    </nav>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const expenseLegend = document.getElementById('expenseLegend');
        const expenseChart = document.getElementById('expenseChart');
        
        // --- LOCAL STORAGE MANAGEMENT ---
        const DEFAULT_MEMBERS_CONFIG = [
            { id: 'father', name: 'Папа', icon: 'male', role: 'Основной пользователь', type: 'main', editable: true, removable: false },
            { id: 'mother', name: 'Мама', icon: 'female', role: 'Пользователь', type: 'user', editable: true, removable: false },
            { id: 'child', name: 'Ребенок', icon: 'child', role: 'Зависимый профиль', type: 'dependent', editable: true, removable: true }
        ];

        function getFamilyMembers() {
            const membersJson = localStorage.getItem('family_members');
            if (membersJson) {
                return JSON.parse(membersJson);
            }
            // Инициализация при первом запуске, если нет данных
            localStorage.setItem('family_members', JSON.stringify(DEFAULT_MEMBERS_CONFIG));
            return DEFAULT_MEMBERS_CONFIG;
        }

        // --- CHART LEGEND LOGIC ---
        const CHART_COLORS = [
            'var(--chart-color-1)', // 0: Dark Red (Ребенок)
            'var(--chart-color-2)', // 1: Medium Red (Мама)
            'var(--chart-color-3)', // 2: Alfa Red (Папа)
            'var(--chart-color-4)', // 3: Light Red (Dynamic 1)
            'var(--chart-color-5)', // 4: Pink (Dynamic 2)
            '#FFD700',              // 5: Gold
            '#4CAF50'               // 6: Green
        ];

        // Условные данные для диаграммы (для демонстрации)
        const PLACEHOLDER_DATA = {
            father: { amount: '67 500 ₽', percentage: 45 },
            mother: { amount: '52 500 ₽', percentage: 35 },
            child: { amount: '30 000 ₽', percentage: 20 },
            dynamic: { amount: '10 000 ₽', percentage: 10 } // Заглушка для новых членов
        };

        function renderExpenseLegend() {
            const members = getFamilyMembers();
            expenseLegend.innerHTML = ''; // Очистка легенды
            
            let conicGradient = '';
            let currentPercentage = 0;
            
            members.forEach((member, index) => {
                const name = member.name;
                const color = CHART_COLORS[index % CHART_COLORS.length]; // Цикличность цветов
                
                // Используем заглушку, но пытаемся найти по ID
                const data = PLACEHOLDER_DATA[member.id] || PLACEHOLDER_DATA['dynamic'];
                
                const percentage = data.percentage || 0;
                const amount = data.amount || 'N/A';
                
                // Создание градиента для диаграммы
                conicGradient += `${color} ${currentPercentage}% ${currentPercentage + percentage}%, `;
                currentPercentage += percentage;
                
                // Создание элемента легенды
                const listItem = document.createElement('li');
                listItem.className = 'legend-item';
                listItem.innerHTML = `
                    <span class="legend-name">
                        <span class="legend-dot" style="background-color: ${color};"></span>
                        ${name}:
                    </span>
                    <span class="legend-amount">**${amount}**</span>
                `;
                expenseLegend.appendChild(listItem);
            });
            
            // Обновление диаграммы
            conicGradient = conicGradient.trim().replace(/,\s*$/, '');
            if (conicGradient) {
                 expenseChart.style.background = `conic-gradient(${conicGradient})`;
            }
        }
        
        // --- ИНИЦИАЛИЗАЦИЯ И НАВИГАЦИЯ ---
        renderExpenseLegend();

        document.getElementById('navToExpenses').addEventListener('click', () => {
            window.location.href = 'details_expenses.html'; 
        });
        document.getElementById('navToIncome').addEventListener('click', () => {
            window.location.href = 'details_income.html'; 
        });
        document.getElementById('navToSettingsFamily').addEventListener('click', () => {
            window.location.href = 'settings_family.html'; 
        });
        document.getElementById('navToDetailsExpenses').addEventListener('click', () => {
            window.location.href = 'details_expenses.html'; 
        });
        document.getElementById('navToAiRecommendations').addEventListener('click', () => {
            alert('Переход на Рекомендации ИИ');
            // window.location.href = 'ai_recommendations.html';
        });
        document.getElementById('editChartLegend').addEventListener('click', () => {
            window.location.href = 'settings_family.html';
        });
        document.getElementById('exportChart').addEventListener('click', () => {
            alert('Данные экспортированы в формате CSV.');
        });
        document.getElementById('navToImportData').addEventListener('click', () => {
            alert('Переход на Импорт данных');
            // window.location.href = 'import_data.html';
        });
    });
</script>
</body>
</html>
