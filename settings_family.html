<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Настройка семьи</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Общие переменные и стили */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
        }

        :root {
            --alfa-red: #EE3124;
            --text-color: #333;
            --bg-light-gray: #F7F7F7;
        }

        .app-screen {
            width: 100%;
            max-width: 390px;
            background-color: white;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* HEADER */
        .header-nav {
            padding: 0 20px;
        }

        .back-title {
            display: flex;
            align-items: center;
            padding: 15px 0 20px 0;
            font-size: 20px;
            font-weight: 600;
        }

        .back-arrow {
            font-size: 22px;
            margin-right: 15px;
            cursor: pointer;
            color: #000;
        }

        /* CONTENT */
        .content {
            padding: 0 0 20px 0; /* Убираем горизонтальный padding, т.к. список его добавит */
        }
        
        .section-title {
            font-size: 14px;
            color: #999;
            font-weight: 500;
            padding: 15px 20px 10px 20px;
            text-transform: uppercase;
        }

        /* MEMBER LIST */
        .member-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .member-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .member-item:last-of-type {
            border-bottom: none;
        }
        
        .member-info {
            display: flex;
            align-items: center;
        }

        .initials-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-right: 15px;
        }
        /* Цвета из скриншота */
        .initials-b { background-color: #8D99AE; } /* Серо-коричневый для В */
        .initials-l { background-color: #EE3124; } /* Красный Альфа для Л */
        .initials-o { background-color: #F7A855; } /* Оранжевый для О */
        
        .member-name {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-color);
        }

        .rename-action {
            display: flex;
            align-items: center;
            color: #999;
            font-size: 14px;
        }
        .rename-action i {
            margin-left: 8px;
            font-size: 16px;
        }

        /* ADD BUTTON */
        .button-wrapper {
            padding: 20px;
            background-color: white; /* Фон для кнопки */
        }
        .add-member-button {
            width: 100%;
            background-color: var(--alfa-red);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(238, 49, 36, 0.3);
        }
        .add-member-button i {
            margin-right: 10px;
            font-size: 20px;
        }

    </style>
</head>
<body>

<div class="app-screen">
    <header class="header-nav">
        <div class="back-title">
            <i class="fas fa-chevron-left back-arrow" id="navToAnalytics"></i>
            <span>Настройка семьи</span>
        </div>
    </header>

    <main class="content">

        <div class="section-title">Члены семьи</div>

        <ul class="member-list" id="memberList">
            </ul>
        
        <div class="button-wrapper">
            <button class="add-member-button" id="addMember">
                <i class="fas fa-user-plus"></i> Добавить члена семьи
            </button>
        </div>

    </main>
    
    <div id="renameModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:100; justify-content:center; align-items:center;">
        <div style="background:white; padding:20px; border-radius:15px; width:80%; text-align:center;">
            <h3>Переименование</h3>
            <p>Введите новое имя для <span id="currentMemberName"></span>:</p>
            <input type="text" id="newNameInput" placeholder="Новое имя" style="width:90%; padding:10px; margin-bottom:15px; border: 1px solid #ccc; border-radius: 8px;">
            <button id="saveRename" style="background:var(--alfa-red); color:white; padding:10px 15px; border:none; border-radius:8px; margin-right:10px;">Сохранить</button>
            <button id="cancelRename" style="background:#ddd; color:#333; padding:10px 15px; border:none; border-radius:8px;">Отмена</button>
        </div>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const MEMBER_DATA = [
            // Идентификаторы соответствуют членам семьи в analytics_home.html и details_income.html
            { id: 'child', defaultName: 'Ребенок', initial: 'В', colorClass: 'initials-b' },
            { id: 'mother', defaultName: 'Мама', initial: 'Л', colorClass: 'initials-l' },
            { id: 'father', defaultName: 'Папа', initial: 'О', colorClass: 'initials-o' },
        ];
        
        const memberListContainer = document.getElementById('memberList');
        const renameModal = document.getElementById('renameModal');
        const newNameInput = document.getElementById('newNameInput');
        const currentMemberNameSpan = document.getElementById('currentMemberName');
        const saveRenameButton = document.getElementById('saveRename');
        const cancelRenameButton = document.getElementById('cancelRename');

        let activeMemberId = null;

        // --- 1. Функция: Получение/Установка имени ---
        const getMemberName = (id, defaultName) => {
            return localStorage.getItem(`member_name_${id}`) || defaultName;
        };

        const setMemberName = (id, newName) => {
            localStorage.setItem(`member_name_${id}`, newName);
        };
        
        // --- 2. Функция: Рендеринг списка ---
        const renderMemberList = () => {
            memberListContainer.innerHTML = '';
            
            MEMBER_DATA.forEach(member => {
                const currentName = getMemberName(member.id, member.defaultName);
                const firstLetter = currentName.charAt(0).toUpperCase();
                
                const item = document.createElement('li');
                item.className = 'member-item';
                item.setAttribute('data-member-id', member.id);
                item.setAttribute('data-member-name', currentName);
                
                item.innerHTML = `
                    <div class="member-info">
                        <div class="initials-circle ${member.colorClass}">${firstLetter}</div>
                        <div class="member-name">${currentName}</div>
                    </div>
                    <div class="rename-action">
                        Переименовать <i class="fas fa-chevron-right"></i>
                    </div>
                `;
                
                item.addEventListener('click', () => showRenameModal(member.id, currentName));
                memberListContainer.appendChild(item);
            });
        };
        
        // --- 3. ЛОГИКА МОДАЛЬНОГО ОКНА ---
        const showRenameModal = (id, currentName) => {
            activeMemberId = id;
            currentMemberNameSpan.textContent = currentName;
            newNameInput.value = currentName;
            
            renameModal.style.display = 'flex';
            newNameInput.focus();
        };

        const hideRenameModal = () => {
            renameModal.style.display = 'none';
            activeMemberId = null;
        };
        
        saveRenameButton.addEventListener('click', () => {
            if (activeMemberId) {
                const newName = newNameInput.value.trim();
                // Используем "Мама", "Папа", "Ребенок" как запасные имена, если поле пустое
                const defaultObject = MEMBER_DATA.find(m => m.id === activeMemberId);
                const finalName = newName || defaultObject.defaultName; 
                
                setMemberName(activeMemberId, finalName);
                renderMemberList(); // Перерисовываем список, чтобы увидеть изменения
                hideRenameModal();
                alert(`Имя успешно изменено на: ${finalName}. Изменения отобразятся на экране аналитики.`);
            }
        });

        cancelRenameButton.addEventListener('click', hideRenameModal);
        
        // Позволяет сохранить по Enter
        newNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveRenameButton.click();
            }
        });


        // --- 4. ЛОГИКА ПЕРЕХОДОВ ---
        
        // Переход обратно на экран аналитики
        document.getElementById('navToAnalytics').addEventListener('click', () => {
            window.location.href = 'analytics_home.html';
        });
        
        // Заглушка для кнопки "Добавить члена семьи"
        document.getElementById('addMember').addEventListener('click', () => {
            alert('Функционал добавления нового члена семьи не реализован.');
        });


        // Инициализация
        renderMemberList();
    });
</script>
</body>
</html>
